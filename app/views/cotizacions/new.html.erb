  <% content_for :boton do %>
    <%= link_to  "Regresar", cotizacions_path ,class:'btn btn-primary'%>
  <% end %> 

<div class="card mt-s">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="text text-secondary">Cotizar</h3>
    <h3><%=  @reque.id %></h3>
  </div>

<table class="table table-responsive table-bordered">
  <thead>
    <tr>
      <th>id producto</th>
      <th>cantidad</th>
      <th>Nombre</th>
      <th>Precio Unitario Propuesto</th>
      <th>SubTotal</th>
    </tr>
  </thead>
  <tbody>
    <% @lineas.each do |linea| %>
      <tr>
          <td>
            <strong><%=  linea.producto_id %></strong>
          </td>
          <td>
            <p class="cantidad"><%=  linea.cantidad %></p>
          </td>
          <td>
            
          </td>
          <td>
            <input type="number" class="valor" min="0"  value="0" onchange="calcular('valor','cantidad','subtotal')">
          </td>
          
          <td>
            
              
          <input type="number" class="subtotal" disabled>
              
          </td>

        
      </tr>
    <%end %>    
  </tbody>
</table>
<div class="card mt-s">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h3 class="text text-secondary">Nueva Cotizacion</h3>
  

</div>

<div class="container ">


  <div class="card-body ">
    <%= form_for @cotizacion do |form| %>
      <% if @cotizacion.errors.any? %>
        <div style="color: red">
          <h2><%= pluralize(cotizacion.errors.count, "error") %> prohibited this cotizacion from being saved:</h2>
    
          <ul>
            <% cotizacion.errors.each do |error| %>
              <li><%= error.full_message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    
      
      
      <div class="form-group row"> 
       
        <input class="form-control" value="<%= @provee[0].id %>" autocomplete="off" type="hidden" name="cotizacion[estado]" id="cotizacion_estado" />
        
        <div class="col-sm-4">
         
        </div>
        
      </div>
    
      <div class="form-group row">
        <%= form.label :descuento_efectivo ,class:'col-sm-4', style: "display: block" %>
        <div class="col-sm-4">
          <%= form.number_field :descuento_efectivo , class:'form-control', step:"0.01", min:"0", max:"1" %>
        </div>
        
      </div>
    
      <div class="form-group row">
        <%= form.label :descuento_pronto_pago,class:'col-sm-4', style: "display: block" %>
        <div class="col-sm-4">
          <%= form.number_field :descuento_pronto_pago, class:'form-control', step:"0.01", min:"0", max:"1" %>
        </div>
        
      </div>
    
      <div class="form-group row">
        <%= form.label :descuento_volumen,class:'col-sm-4', style: "display: block" %>
        <div class="col-sm-4">
          <%= form.number_field :descuento_volumen, class:'form-control', step:"0.01", min:"0", max:"1" %>
        </div>
        
      </div>
    
      <div class="form-group row">
        <%= form.label :descuento_forma_pago,class:'col-sm-4', style: "display: block" %>
          <div class="col-sm-4">
          <%= form.number_field :descuento_forma_pago, class:'form-control', step:"0.01", min:"0", max:"1" %>
        </div>
          
      </div>
    
      <div class="form-group row">
        <%= form.label :envases_embalage,class:'col-sm-4', style: "display: block" %>
          <div class="col-sm-4">
          <%= form.number_field :envases_embalage, class:'form-control', step:"0.01", min:"0" %>
        </div>
        
      </div>
    
      <div class="form-group row">
        <%= form.label :pago_transporte,class:'col-sm-4', style: "display: block" %>
          <div class="col-sm-4">
          <%= form.number_field :pago_transporte, class:'form-control', step:"0.01", min:"0" %>
        </div>
        
      </div>
    
      <div class="form-group row">
        <%= form.label :recargo_aplazamiento,class:'col-sm-4', style: "display: block" %>
        <div class="col-sm-4">
          <%= form.number_field :recargo_aplazamiento, class:'form-control' , step:"0.01", min:"0", max:"1"  %>
        </div>
        
      </div>
    
      <div class="form-group row">
      
          <div class="col-sm-4">
          <%= form.hidden_field :estado, class:'form-control', value: 'Pendiente' %>
        </div>
        
      </div>
    
      <div class="form-group row">
        <%= form.label :fecha_entrega,class:'col-sm-4', style: "display: block" %>
        <div class="col-sm-4">
          <%= form.date_field :fecha_entrega, class:'form-control', required:"true" %>
        </div>

         <div class="form-group row">
        <%= form.label :total,class:'col-sm-4', style: "display: block"  %>
        <div class="col-sm-4">
          <%= form.number_field :total, class:'form-control', step:"0.01", min:"0", disabled:"true" %>
        </div>
        
      </div>
        
      </div>
        <div class="btn-toolbar" role="toolbar">
              <div class="btn-group" role="group">
              
              <input type="button" value="Calcular total" name="button" class='btn btn-primary' onclick="total('subtotal')">
              
              
                          
              </div>
        </div>
   <input type="submit" name="commit"  value="Crear Cotizacion" data-disable-with="Create Cotizacion" visibility="hide" disabled id="guardar" class='btn btn-primary'/>
     

    <% end %>
  </div>
 <script src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.js'></script>
 <script type = "text/javascript">
         function calcular(valor,cant,sub){
           
          var txtPrecio=document.getElementsByClassName(valor);
          var txtCantidad=document.getElementsByClassName(cant);
          var lblSubtotal=document.getElementsByClassName(sub);
          console.log(txtCantidad[0].innerHTML);
          console.log(txtPrecio[0].value);
          console.log(lblSubtotal.length);
          
          for(var i=0; i<txtCantidad.length;i++){
            var precio=Number(txtPrecio[i].value);
            var cantidad=Number(txtCantidad[i].innerHTML);
            var res=precio*cantidad;
            lblSubtotal[i].value=res;
            console.log(precio*cantidad);
          }

          }
         
</script>
<script type = "text/javascript">
 function total(subt){
            document.getElementById("guardar").disabled=false;
            var txtTotal=document.getElementById("cotizacion_total");
            var lbSubtotal=document.getElementsByClassName(subt);
            var total=0;
            console.log(lbSubtotal.length);
            console.log(total);
            for(var j=0; j<lbSubtotal.length ; j++){
              total+=Number(lbSubtotal[j].value);
              console.log(lbSubtotal[j].value);
              
            }
            console.log(total);
            txtTotal.value=total;
          }
</script>

<script type="text/javascript">
$(document).ready(function(){
 
 $('#habilitar').click(function(){
  $('#guardar').prop('disabled', false);
 }
 );
});
</script>
